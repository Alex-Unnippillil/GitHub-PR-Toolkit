name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  lint:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install PSScriptAnalyzer
        shell: pwsh
        run: Install-Module PSScriptAnalyzer -Scope CurrentUser -Force
      - name: Run PSScriptAnalyzer
        shell: pwsh
        run: |
          $files = Get-ChildItem -Recurse -Include *.ps1
          if ($files) {
            Invoke-ScriptAnalyzer -Path $files.FullName -Recurse -Severity Warning,Error | Format-Table -AutoSize
          } else {
            Write-Host "No PowerShell files found to lint."
          }
  smoke:
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Basic PowerShell check
        shell: pwsh
        run: pwsh -NoLogo -NoProfile -Command "Get-ChildItem -Recurse | Out-Null"
